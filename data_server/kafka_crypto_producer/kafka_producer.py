from binance.websocket.spot.websocket_client import SpotWebsocketClient as WebsocketClient
from kafka import KafkaProducer
import json
from time import sleep
import time
from datetime import datetime

producer = KafkaProducer(bootstrap_servers=['172.1.0.13:9092', '172.1.0.12:9092', '172.1.0.11:9092'],
                         value_serializer=lambda v: json.dumps(v).encode('utf-8'))

def message_handler(message):
    event_time = datetime.utcfromtimestamp(
        int(message['data']["E"]) / 1000).strftime('%Y-%m-%d %H:%M:%S')
    Symbol = message['data']['s']
    Close_price = message['data']['c']
    Open_price = message['data']['o']
    High_price = message['data']['h']
    Low_price = message['data']['l']
    Base_volume = message['data']['v']
    Quote_volume = message['data']['q']
    crypto = {'Symbol': Symbol, 'Close_price': float(Close_price), 'Open_price': float(Open_price), 'High_price': float(High_price),
              'Low_price': float(Low_price), 'Base_volume': float(Base_volume), 'Quote_volume': float(Quote_volume), 'time': event_time}
    print(crypto)
    producer.send(topic='crypto', value=crypto)


ws_client = WebsocketClient()
ws_client.start()

ws_client.instant_subscribe(
    stream=['ethbtc@miniTicker', 'ltcbtc@miniTicker', 'bnbbtc@miniTicker', 'neobtc@miniTicker', 'eoseth@miniTicker', 'bnbeth@miniTicker', 'btcusdt@miniTicker', 'ethusdt@miniTicker', 'lrcbtc@miniTicker', 'qtumbtc@miniTicker', 'omgbtc@miniTicker', 'zrxbtc@miniTicker', 'kncbtc@miniTicker', 'funbtc@miniTicker', 'iotabtc@miniTicker', 'linkbtc@miniTicker', 'linketh@miniTicker', 'mtlbtc@miniTicker', 'eosbtc@miniTicker', 'etcbtc@miniTicker', 'zecbtc@miniTicker', 'bntbtc@miniTicker', 'dashbtc@miniTicker', 'trxbtc@miniTicker', 'trxeth@miniTicker', 'xrpbtc@miniTicker', 'xrpeth@miniTicker', 'enjbtc@miniTicker', 'storjbtc@miniTicker', 'bnbusdt@miniTicker', 'nulsbtc@miniTicker', 'xmrbtc@miniTicker', 'xmreth@miniTicker', 'batbtc@miniTicker', 'neousdt@miniTicker', 'btsbtc@miniTicker', 'manabtc@miniTicker', 'adabtc@miniTicker', 'adaeth@miniTicker', 'xlmbtc@miniTicker', 'lendbtc@miniTicker', 'ltceth@miniTicker', 'ltcusdt@miniTicker', 'wavesbtc@miniTicker', 'gtobtc@miniTicker', 'rlcbtc@miniTicker', 'iostbtc@miniTicker', 'blzbtc@miniTicker', 'zilbtc@miniTicker', 'ontbtc@miniTicker', 'qtumusdt@miniTicker', 'adausdt@miniTicker', 'xrpusdt@miniTicker', 'repbtc@miniTicker', 'eosusdt@miniTicker', 'thetabtc@miniTicker', 'iotausdt@miniTicker', 'xlmusdt@miniTicker', 'iotxbtc@miniTicker', 'ontusdt@miniTicker', 'trxusdt@miniTicker', 'etcusdt@miniTicker', 'icxusdt@miniTicker', 'denteth@miniTicker', 'nulsusdt@miniTicker', 'vetbtc@miniTicker', 'vetusdt@miniTicker', 'dockbtc@miniTicker', 'rvnbtc@miniTicker', 'mithbtc@miniTicker', 'renbtc@miniTicker', 'linkusdt@miniTicker', 'wavesusdt@miniTicker', 'ongusdt@miniTicker', 'hotusdt@miniTicker', 'zilusdt@miniTicker', 'zrxusdt@miniTicker', 'fetbtc@miniTicker', 'fetusdt@miniTicker', 'batusdt@miniTicker', 'xmrusdt@miniTicker', 'zecusdt@miniTicker', 'iostusdt@miniTicker', 'celrbtc@miniTicker', 'celrusdt@miniTicker', 'dashusdt@miniTicker', 'omgusdt@miniTicker', 'thetausdt@miniTicker', 'enjusdt@miniTicker', 'mithusdt@miniTicker', 'maticbtc@miniTicker', 'maticusdt@miniTicker', 'atombtc@miniTicker', 'atomusdt@miniTicker', 'tfuelbtc@miniTicker', 'tfuelusdt@miniTicker', 'onebtc@miniTicker', 'oneusdt@miniTicker', 'ftmbtc@miniTicker', 'ftmusdt@miniTicker', 'algobtc@miniTicker', 'algousdt@miniTicker', 'gtousdt@miniTicker', 'dogebtc@miniTicker', 'dogeusdt@miniTicker', 'duskbtc@miniTicker', 'duskusdt@miniTicker', 'ankrbtc@miniTicker', 'ankrusdt@miniTicker', 'winusdt@miniTicker', 'cosbtc@miniTicker', 'cosusdt@miniTicker', 'mtlusdt@miniTicker', 'tomobtc@miniTicker', 'tomousdt@miniTicker', 'dentusdt@miniTicker', 'mftusdt@miniTicker', 'keyusdt@miniTicker', 'dockusdt@miniTicker', 'wanusdt@miniTicker', 'funusdt@miniTicker', 'cvcusdt@miniTicker', 'chzbtc@miniTicker', 'chzusdt@miniTicker', 'bandbtc@miniTicker', 'bandusdt@miniTicker', 'bnbbusd@miniTicker', 'btcbusd@miniTicker', 'busdusdt@miniTicker', 'beamusdt@miniTicker', 'xtzbtc@miniTicker', 'xtzusdt@miniTicker', 'renusdt@miniTicker', 'rvnusdt@miniTicker', 'hbarbtc@miniTicker', 'hbarusdt@miniTicker', 'nknbtc@miniTicker', 'nknusdt@miniTicker', 'xrpbusd@miniTicker', 'ethbusd@miniTicker', 'ltcbusd@miniTicker', 'linkbusd@miniTicker', 'etcbusd@miniTicker', 'stxbtc@miniTicker', 'stxusdt@miniTicker', 'kavabtc@miniTicker', 'kavausdt@miniTicker', 'arpabtc@miniTicker', 'arpausdt@miniTicker', 'trxbusd@miniTicker', 'eosbusd@miniTicker', 'iotxusdt@miniTicker', 'rlcusdt@miniTicker', 'xlmbusd@miniTicker', 'adabusd@miniTicker', 'ctxcbtc@miniTicker', 'ctxcusdt@miniTicker', 'bchbtc@miniTicker', 'bchusdt@miniTicker', 'bchbusd@miniTicker', 'troybtc@miniTicker', 'troyusdt@miniTicker', 'vetbusd@miniTicker', 'ognbtc@miniTicker', 'ognusdt@miniTicker', 'drepusdt@miniTicker', 'icxbusd@miniTicker', 'btsusdt@miniTicker', 'bntusdt@miniTicker', 'ltobtc@miniTicker', 'ltousdt@miniTicker', 'atombusd@miniTicker', 'dashbusd@miniTicker', 'neobusd@miniTicker', 'wavesbusd@miniTicker', 'xtzbusd@miniTicker', 'batbusd@miniTicker', 'enjbusd@miniTicker', 'ontbusd@miniTicker', 'mblusdt@miniTicker', 'cotibtc@miniTicker', 'cotiusdt@miniTicker', 'algobusd@miniTicker', 'xmrbusd@miniTicker', 'stptbtc@miniTicker', 'stptusdt@miniTicker', 'databusd@miniTicker', 'datausdt@miniTicker', 'solbtc@miniTicker', 'solusdt@miniTicker', 'solbusd@miniTicker', 'ctsibtc@miniTicker', 'ctsiusdt@miniTicker', 'hivebtc@miniTicker', 'hiveusdt@miniTicker', 'chrbtc@miniTicker', 'chrusdt@miniTicker', 'lendusdt@miniTicker', 'hbarbusd@miniTicker', 'maticbusd@miniTicker', 'zilbusd@miniTicker', 'mdtbtc@miniTicker', 'mdtusdt@miniTicker', 'stmxbtc@miniTicker', 'stmxusdt@miniTicker', 'kncbusd@miniTicker', 'kncusdt@miniTicker', 'repusdt@miniTicker', 'lrcbusd@miniTicker', 'lrcusdt@miniTicker', 'pntbtc@miniTicker', 'pntusdt@miniTicker', 'dgbbtc@miniTicker', 'dgbbusd@miniTicker', 'compbtc@miniTicker', 'compbusd@miniTicker', 'compusdt@miniTicker', 'scusdt@miniTicker', 'sxpbtc@miniTicker', 'sxpbusd@miniTicker', 'snxbtc@miniTicker', 'snxbusd@miniTicker', 'snxusdt@miniTicker', 'dgbusdt@miniTicker', 'sxpusdt@miniTicker', 'mkrbtc@miniTicker', 'mkrusdt@miniTicker', 'mkrbusd@miniTicker', 'runebtc@miniTicker', 'runebusd@miniTicker', 'manabusd@miniTicker', 'dogebusd@miniTicker', 'storjusdt@miniTicker', 'fiobusd@miniTicker', 'avabusd@miniTicker', 'manausdt@miniTicker', 'balbtc@miniTicker', 'balusdt@miniTicker', 'blzusdt@miniTicker', 'kmdusdt@miniTicker', 'jstbtc@miniTicker', 'jstbusd@miniTicker', 'jstusdt@miniTicker', 'srmbtc@miniTicker', 'srmbusd@miniTicker', 'srmusdt@miniTicker', 'antbtc@miniTicker', 'antbusd@miniTicker', 'antusdt@miniTicker', 'crvbtc@miniTicker', 'crvbusd@miniTicker', 'crvusdt@miniTicker', 'sandbtc@miniTicker', 'sandusdt@miniTicker', 'sandbusd@miniTicker', 'oceanbtc@miniTicker', 'oceanusdt@miniTicker', 'nmrbtc@miniTicker', 'nmrbusd@miniTicker', 'nmrusdt@miniTicker', 'dotbtc@miniTicker', 'dotbusd@miniTicker', 'dotusdt@miniTicker', 'lunabtc@miniTicker', 'lunabusd@miniTicker', 'lunausdt@miniTicker', 'idexbtc@miniTicker', 'idexbusd@miniTicker', 'rsrbusd@miniTicker', 'rsrusdt@miniTicker', 'paxgbusd@miniTicker', 'paxgusdt@miniTicker', 'wnxmbtc@miniTicker', 'wnxmusdt@miniTicker', 'trbbtc@miniTicker', 'trbbusd@miniTicker', 'trbusdt@miniTicker', 'bzrxbtc@miniTicker', 'bzrxusdt@miniTicker', 'sushibtc@miniTicker', 'sushiusdt@miniTicker', 'ksmbtc@miniTicker', 'ksmbusd@miniTicker', 'ksmusdt@miniTicker', 'egldbtc@miniTicker', 'egldbusd@miniTicker', 'egldusdt@miniTicker', 'diabtc@miniTicker', 'diausdt@miniTicker', 'runeusdt@miniTicker', 'fiousdt@miniTicker', 'umabtc@miniTicker', 'umausdt@miniTicker', 'belbusd@miniTicker', 'belusdt@miniTicker', 'wingbusd@miniTicker', 'wingusdt@miniTicker', 'creambusd@miniTicker', 'unibtc@miniTicker', 'unibusd@miniTicker', 'uniusdt@miniTicker', 'nbsbtc@miniTicker', 'oxtbtc@miniTicker', 'oxtusdt@miniTicker', 'sunusdt@miniTicker', 'avaxbtc@miniTicker', 'avaxbusd@miniTicker', 'avaxusdt@miniTicker', 'flmusdt@miniTicker', 'cakebusd@miniTicker', 'ornbtc@miniTicker', 'ornusdt@miniTicker', 'utkbtc@miniTicker', 'utkusdt@miniTicker', 'xvsbtc@miniTicker', 'xvsbusd@miniTicker', 'xvsusdt@miniTicker', 'alphabtc@miniTicker', 'alphausdt@miniTicker', 'aavebtc@miniTicker', 'aavebusd@miniTicker', 'aaveusdt@miniTicker', 'nearbtc@miniTicker', 'nearbusd@miniTicker', 'nearusdt@miniTicker', 'filbtc@miniTicker', 'filbusd@miniTicker', 'filusdt@miniTicker', 'injbtc@miniTicker', 'injbusd@miniTicker', 'injusdt@miniTicker', 'onebusd@miniTicker', 'audiobtc@miniTicker', 'audiobusd@miniTicker', 'audiousdt@miniTicker', 'ctkusdt@miniTicker', 'akrousdt@miniTicker', 'kp3rbusd@miniTicker', 'axsbtc@miniTicker', 'axsbusd@miniTicker', 'axsusdt@miniTicker', 'hardbusd@miniTicker', 'hardusdt@miniTicker', 'slpeth@miniTicker', 'cvpbusd@miniTicker', 'straxbusd@miniTicker', 'straxusdt@miniTicker', 'unfiusdt@miniTicker', 'frontbusd@miniTicker', 'rosebtc@miniTicker', 'rosebusd@miniTicker', 'roseusdt@miniTicker', 'avausdt@miniTicker', 'xemusdt@miniTicker', 'hegicbusd@miniTicker', 'sklbtc@miniTicker', 'sklbusd@miniTicker', 'sklusdt@miniTicker', 'glmbtc@miniTicker', 'dfbusd@miniTicker', 'grtbtc@miniTicker', 'grteth@miniTicker', 'grtusdt@miniTicker', '1inchbtc@miniTicker', '1inchusdt@miniTicker', 'reefusdt@miniTicker', 'celousdt@miniTicker', 'trubtc@miniTicker', 'truusdt@miniTicker', 'dexebusd@miniTicker', 'ckbusdt@miniTicker', 'twtusdt@miniTicker', 'litbtc@miniTicker', 'litbusd@miniTicker', 'litusdt@miniTicker', 'sfpbtc@miniTicker', 'sfpbusd@miniTicker', 'sfpusdt@miniTicker', 'dodobtc@miniTicker', 'dodobusd@miniTicker', 'dodousdt@miniTicker', 'cakebtc@miniTicker', 'cakeusdt@miniTicker', 'bakebusd@miniTicker', 'reefbusd@miniTicker', 'auctionbusd@miniTicker', 'phabusd@miniTicker', 'tvkbtc@miniTicker', 'tvkbusd@miniTicker', 'badgerbtc@miniTicker', 'badgerbusd@miniTicker', 'badgerusdt@miniTicker', 'ombtc@miniTicker', 'ombusd@miniTicker', 'omusdt@miniTicker', 'pondbtc@miniTicker', 'pondbusd@miniTicker', 'pondusdt@miniTicker', 'degobusd@miniTicker', 'degousdt@miniTicker', 'alicebtc@miniTicker', 'alicebusd@miniTicker', 'aliceusdt@miniTicker', 'linabtc@miniTicker', 'linabusd@miniTicker', 'linausdt@miniTicker', 'superbtc@miniTicker', 'superbusd@miniTicker', 'superusdt@miniTicker', 'epsbtc@miniTicker', 'epsbusd@miniTicker', 'epsusdt@miniTicker', 'pundixusdt@miniTicker', 'tlmbtc@miniTicker', 'tlmbusd@miniTicker', 'tlmusdt@miniTicker', 'hotbusd@miniTicker', 'forthbusd@miniTicker', 'forthusdt@miniTicker', 'bakeusdt@miniTicker', 'burgerbusd@miniTicker', 'burgerusdt@miniTicker', 'slpbusd@miniTicker', 'slpusdt@miniTicker', 'shibusdt@miniTicker', 'shibbusd@miniTicker', 'icpbtc@miniTicker', 'icpbusd@miniTicker', 'icpusdt@miniTicker', 'arusdt@miniTicker', 'polsbtc@miniTicker', 'polsbusd@miniTicker', 'polsusdt@miniTicker', 'mdxbtc@miniTicker', 'mdxbusd@miniTicker', 'mdxusdt@miniTicker', 'maskbusd@miniTicker', 'maskusdt@miniTicker', 'lptbtc@miniTicker', 'lptbusd@miniTicker', 'lptusdt@miniTicker', 'ftmbusd@miniTicker', 'winbusd@miniTicker', 'kavabusd@miniTicker', 'atabtc@miniTicker', 'atabusd@miniTicker', 'atausdt@miniTicker', 'gtcbtc@miniTicker', 'gtcbusd@miniTicker', 'gtcusdt@miniTicker', 'bakebtc@miniTicker', 'cotibusd@miniTicker', 'scbusd@miniTicker', 'chrbusd@miniTicker', 'ernbusd@miniTicker', 'ernusdt@miniTicker', 'klaybusd@miniTicker', 'klayusdt@miniTicker', 'iotxbusd@miniTicker', 'phausdt@miniTicker', 'bondbtc@miniTicker', 'bondbusd@miniTicker', 'bondusdt@miniTicker', 'mlnbtc@miniTicker', 'mlnbusd@miniTicker', 'mlnusdt@miniTicker', 'dexeusdt@miniTicker', 'quickbtc@miniTicker', 'quickbusd@miniTicker', 'c98usdt@miniTicker', 'c98busd@miniTicker', 'c98btc@miniTicker', 'clvbtc@miniTicker', 'clvbusd@miniTicker', 'clvusdt@miniTicker', 'qntbtc@miniTicker', 'qntbusd@miniTicker', 'qntusdt@miniTicker', 'flowbtc@miniTicker', 'flowbusd@miniTicker', 'flowusdt@miniTicker', 'xecbusd@miniTicker', 'tvkusdt@miniTicker', 'minabtc@miniTicker', 'minabusd@miniTicker', 'minausdt@miniTicker', 'raybusd@miniTicker', 'rayusdt@miniTicker', 'quickusdt@miniTicker', 'mboxbtc@miniTicker', 'mboxbusd@miniTicker', 'mboxusdt@miniTicker', 'requsdt@miniTicker', 'waxpusdt@miniTicker', 'waxpbusd@miniTicker', 'waxpbtc@miniTicker', 'tribebusd@miniTicker', 'tribeusdt@miniTicker', 'mtlbusd@miniTicker', 'ognbusd@miniTicker', 'xecusdt@miniTicker', 'dydxusdt@miniTicker', 'dydxbusd@miniTicker', 'idexusdt@miniTicker', 'galausdt@miniTicker', 'galabusd@miniTicker', 'galabtc@miniTicker', 'sunbusd@miniTicker', 'yggusdt@miniTicker', 'yggbusd@miniTicker', 'stxbusd@miniTicker', 'fetbusd@miniTicker', 'arpabusd@miniTicker', 'fidausdt@miniTicker', 'fidabusd@miniTicker', 'cvpusdt@miniTicker', 'agldbtc@miniTicker', 'agldbusd@miniTicker', 'agldusdt@miniTicker', 'radbusd@miniTicker', 'radusdt@miniTicker', 'hivebusd@miniTicker', 'stptbusd@miniTicker', 'betausdt@miniTicker', 'rarebusd@miniTicker', 'rareusdt@miniTicker', 'troybusd@miniTicker', 'laziousdt@miniTicker', 'chessbtc@miniTicker', 'chessbusd@miniTicker', 'chessusdt@miniTicker', 'auctionusdt@miniTicker', 'celobusd@miniTicker', 'shibdoge@miniTicker', 'darusdt@miniTicker', 'darbusd@miniTicker', 'darbtc@miniTicker', 'bnxbtc@miniTicker', 'bnxbusd@miniTicker', 'bnxusdt@miniTicker', 'laziobusd@miniTicker', 'ensbtc@miniTicker', 'ensbusd@miniTicker', 'ensusdt@miniTicker', 'ankrbusd@miniTicker', 'kp3rusdt@miniTicker', 'qiusdt@miniTicker', 'portousdt@miniTicker', 'jasmyusdt@miniTicker', 'jasmybusd@miniTicker', 'jasmybtc@miniTicker', 'pyrbtc@miniTicker', 'pyrbusd@miniTicker', 'pyrusdt@miniTicker', 'rndrbtc@miniTicker', 'rndrusdt@miniTicker', 'rndrbusd@miniTicker', 'santosusdt@miniTicker', 'bicobtc@miniTicker', 'bicobusd@miniTicker', 'bicousdt@miniTicker', 'fluxbusd@miniTicker', 'fluxusdt@miniTicker', 'reqbusd@miniTicker', 'voxelbusd@miniTicker', 'voxelusdt@miniTicker', 'ctxcbusd@miniTicker', 'highbusd@miniTicker', 'highusdt@miniTicker', 'peoplebtc@miniTicker', 'peoplebusd@miniTicker', 'peopleusdt@miniTicker', 'nulsbusd@miniTicker', 'spellusdt@miniTicker', 'spellbusd@miniTicker', 'ustbtc@miniTicker', 'ustusdt@miniTicker', 'ethust@miniTicker', 'achbusd@miniTicker', 'achusdt@miniTicker', 'imxbusd@miniTicker', 'imxusdt@miniTicker', 'glmrbusd@miniTicker', 'glmrusdt@miniTicker', 'lokabusd@miniTicker', 'lokausdt@miniTicker', 'api3usdt@miniTicker', 'ancbusd@miniTicker', 'ancusdt@miniTicker', 'woousdt@miniTicker', 'astrbusd@miniTicker', 'astrusdt@miniTicker', 'gmtbusd@miniTicker', 'gmtusdt@miniTicker', 'kdabusd@miniTicker', 'kdausdt@miniTicker', 'apeusdt@miniTicker', 'apebusd@miniTicker', 'apebtc@miniTicker', 'bswusdt@miniTicker', 'bswbusd@miniTicker', 'santosbusd@miniTicker', 'apeeth@miniTicker', 'portobusd@miniTicker', 'mblbusd@miniTicker', 'mobusdt@miniTicker', 'mobbusd@miniTicker', 'nexousdt@miniTicker', 'nexobusd@miniTicker', 'reiusdt@miniTicker', 'galusdt@miniTicker', 'galbusd@miniTicker', 'ldobusd@miniTicker', 'ldousdt@miniTicker', 'epxusdt@miniTicker', 'epxbusd@miniTicker', 'reibusd@miniTicker', 'drepbusd@miniTicker', 'pundixbusd@miniTicker', 'luncbusd@miniTicker', 'ustcbusd@miniTicker', 'opbusd@miniTicker', 'opusdt@miniTicker', 'leverusdt@miniTicker', 'leverbusd@miniTicker', 'glmbusd@miniTicker', 'stgbusd@miniTicker', 'stgusdt@miniTicker', 'loombusd@miniTicker', 'snmbusd@miniTicker', 'ambbusd@miniTicker', 'luncusdt@miniTicker', 'phbbusd@miniTicker', 'neblbusd@miniTicker', 'vibbusd@miniTicker', 'gmxbusd@miniTicker', 'gmxusdt@miniTicker', 'polyxbusd@miniTicker', 'polyxusdt@miniTicker', 'aptusdt@miniTicker', 'aptbusd@miniTicker', 'osmousdt@miniTicker', 'osmobusd@miniTicker'],
    callback=message_handler,
)

# ws_client.stop()
